---
import { getEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import PostPageLayout from '../../layouts/PostPageLayout.astro';

const { slug } = Astro.params;
if (slug === undefined) {
  throw new Error('Slug is required');
}
const entry = await getEntry('portfolio', slug);
if (entry === undefined) {
  return Astro.redirect('/404');
}
const { Content } = await entry.render();

const portfolioCollection = await getCollection('portfolio');
const pages = portfolioCollection.map((item) => ({
  title: item.data.title,
  path: `/the-work/${item.slug}`,
}));
---

<Layout title={entry.data.title} subPages={pages}>
  <PostPageLayout>
    <Content slot='content' />
    <img src={entry.data.screenshot} alt={entry.data.screenshotAltText} slot='images' />
    <img src={entry.data.screenshotBackground} alt='' slot='images' />
  </PostPageLayout>
</Layout>
